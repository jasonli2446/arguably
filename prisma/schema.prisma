generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UniversalRole {
  ADMIN
  USER
}

enum SessionRole {
  HOST
  MODERATOR
  DEBATER
  AUDIENCE
}

enum SessionType {
  ONE_ON_ONE
  EXPERT_VS_CROWD
  TEAM
  PANEL
}

enum SessionStatus {
  WAITING
  LIVE
  PAUSED
  ENDED
}

model User {
  id         String        @id @db.Uuid
  username   String        @unique
  email      String?
  realname   String?
  role       UniversalRole @default(USER)
  created_at DateTime      @default(now())

  hosted_sessions    Session[]        @relation("HostToSession")
  moderated_sessions Session[]        @relation("ModeratorToSession")
  participates_ins   ParticipatesIn[]
}

model ParticipatesIn {
  participant_id String      @db.Uuid
  session_id     String
  joined_at      DateTime    @default(now())
  left_at        DateTime?
  session_role   SessionRole @default(AUDIENCE)

  user    User    @relation(fields: [participant_id], references: [id])
  session Session @relation(fields: [session_id], references: [id])

  @@id([participant_id, session_id])
}

model Session {
  id               String        @id @default(cuid())
  code             String        @unique
  name             String
  description      String?
  host_id          String        @db.Uuid
  moderator_id     String?       @db.Uuid
  type             SessionType
  status           SessionStatus @default(WAITING)
  max_participants Int           @default(10)
  turn_length      Int           @default(120)
  created_at       DateTime      @default(now())
  ended_at         DateTime?

  host             User             @relation("HostToSession", fields: [host_id], references: [id])
  moderator        User?            @relation("ModeratorToSession", fields: [moderator_id], references: [id])
  participates_ins ParticipatesIn[]
}
